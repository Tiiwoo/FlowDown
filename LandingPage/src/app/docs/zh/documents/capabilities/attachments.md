# 附件管理

附件功能支持将文档、截图、音频或补充说明导入至会话中。浮望会在本地预处理每个文件，将内容转换为结构化上下文，并与提示词一起发送给所选模型。

## 使用范围

- 点击输入框上方的回形针图标即可管理附件（iOS/iPadOS/macOS 通用），也可直接拖拽或粘贴。
- 支持纯文本、Markdown、PDF、常见图像（PNG/JPEG/WebP/HEIC）和音频（m4a/wav，其他音频会自动转码）。不支持的格式将被自动忽略。
- 任意模型均可配合附件；图片需选择具备 **Visual** 能力的模型，音频需选择具备 **Auditory** 能力的模型。

## 处理流程

1. **解析与归档**：根据文件类型，在设备本地提取文本、替代文字与元数据；PDF 可按文本导入或转成分页图片，音频会转码为精简 WAV。
2. **视觉预处理（按需）**：若图片没有描述且未选择跳过识别，浮望会调用 **辅助视觉模型** 生成描述，并本地执行 OCR/二维码识别后写入附件。
   - 当前模型已具备视觉能力时，可在 **设置 → 推理 → 视觉评估 → 尽可能跳过识别** 开启跳过（默认开启）。若你可能切换到纯文本模型，建议关闭以保留文字替代内容。
3. **构建上下文**：每个附件都会在发送前转成用户消息：
   - 文本/PDF/网页：包含 `[filename]` 与提取文本。
   - 图片：视觉模型收到图片与描述；非视觉模型仅收到描述，无描述的图片会被跳过。
   - 音频：音频模型收到 base64 WAV 与描述；其他模型仅收到描述，或标记为已跳过。
4. **发送模型与工具**：整理后的附件与提示一并流式传输给模型；启用工具调用时，工具也能读取附件内容。

![iPad mini 上的“粘贴为附件”菜单](../../../res/screenshots/imgs/mobile-chat-context-menu-functions.png)

## 实用建议

- 仅添加与当前问题相关的文件，过大或无关的附件会增加 token 消耗并分散注意力。
- 多页 PDF 请在提示词中注明页码或章节，引导模型聚焦。
- 计划切换非视觉模型时，关闭“尽可能跳过识别”以生成描述备份。
- 比较多个文件时一次性放入同一条消息，方便模型在同一上下文内引用。
- 回答与附件不符时，提醒模型重新查看附件部分，或补充更清晰的指令后再发。

## 故障排查

- **上传失败**：通常与存储空间不足或格式不受支持有关，可尝试将文件转换为 PDF 或 Markdown 后再试。
- **同步差异**：可在 **数据控制 → 完全刷新 iCloud 数据** 运行一次恢复一致。
- **隐私审计**：附件仅在你触发云端模型、工具调用或 iCloud 同步时才会离开设备。
